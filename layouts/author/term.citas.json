{{- $quotes := slice -}}
{{- $currentAuthor := . -}}
{{- $backtick := "`" -}}
{{- range site.RegularPages -}}
  {{- $page := . -}}
  {{- $content := .RawContent -}}
  {{- /* Find all quote shortcodes */ -}}
  {{- $matches := findRE `(?s)\{\{<\s*quote\s+.*?>\}\}` $content -}}
  {{- range $matches -}}
    {{- $quoteTag := . -}}
    {{- /* Extract author */ -}}
    {{- $authorRaw := replaceRE `(?s).*author="([^"]+)".*` "$1" $quoteTag -}}
    {{- if ne $authorRaw $quoteTag -}}
      {{- $authorPage := site.GetPage (printf "/author/%s" $authorRaw) -}}
      {{- if eq $authorPage $currentAuthor -}}
        {{- $text := "" -}}
        {{- /* Try backticks for text */ -}}
        {{- $pattern := printf `(?s).*text=%s([^%s]+)%s.*` $backtick $backtick $backtick -}}
        {{- $textBackticks := replaceRE $pattern "$1" $quoteTag -}}
        {{- if ne $textBackticks $quoteTag -}}
          {{- $text = $textBackticks -}}
        {{- else -}}
          {{- /* Try double quotes for text */ -}}
          {{- $textQuotes := replaceRE `(?s).*text="([^"]+)".*` "$1" $quoteTag -}}
          {{- if ne $textQuotes $quoteTag -}}
            {{- $text = $textQuotes -}}
          {{- end -}}
        {{- end -}}
        
        {{- /* Extract date */ -}}
        {{- $dateRaw := replaceRE `(?s).*date="([^"]+)".*` "$1" $quoteTag -}}
        {{- $date := $page.Date.Format "Jan 2, 2006" -}}
        {{- if ne $dateRaw $quoteTag -}}
          {{- $date = $dateRaw -}}
        {{- end -}}

        {{- if ne $text "" -}}
          {{- $quoteObj := dict "text" ($text | markdownify | plainify | chomp) "source" $page.Permalink "source_title" $page.Title "date" $date -}}
          {{- $quotes = $quotes | append $quoteObj -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- $quotes | jsonify -}}